<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>Air Hockey - –û–Ω–ª–∞–π–Ω</title>
    <style>
        body { 
            margin: 0; 
            /* –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å–∫—Ä–æ–ª—ñ–Ω–≥—É —Ç–∞ –¥—ñ–π –±—Ä–∞—É–∑–µ—Ä–∞ */
            overflow: hidden; 
            touch-action: none; 
            
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            background-color: #333; 
        }
        #game-area { 
            width: 600px; 
            height: 400px; 
            background-color: #008080; 
            border: 10px solid #ccc; 
            position: relative; 
            overflow: hidden; 
            /* –ê–¥–∞–ø—Ç–∞—Ü—ñ—è —Ä–æ–∑–º—ñ—Ä—É –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            max-width: 95vw; 
            max-height: 95vh;
        }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–ª—é—á–æ–∫ */
        .player-mallet { 
            width: 50px; 
            height: 50px; 
            background-color: white; 
            border-radius: 50%; 
            position: absolute; 
            cursor: pointer; 
            border: 3px solid black; 
            transition: background-color 0.3s; /* –ü–ª–∞–≤–Ω–∞ –∑–º—ñ–Ω–∞ –∫–æ–ª—å–æ—Ä—É */
            z-index: 10;
        }
        #player1 { top: 175px; left: 50px; background-color: blue; }
        #player2 { top: 175px; right: 50px; background-color: red; }
        #status-message { 
            position: absolute; 
            top: 10px; 
            width: 100%;
            text-align: center;
            color: white; 
            font-family: Arial, sans-serif; 
            z-index: 20;
        }
        
        /* –õ—ñ–Ω—ñ—è –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        #game-area::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            width: 2px;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.5);
            transform: translateX(-50%);
        }
    </style>
</head>
<body>
    <div id="game-area">
        <div id="player1" class="player-mallet"></div>
        <div id="player2" class="player-mallet"></div>
        <div id="status-message">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...</div>
    </div>

    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script>
        // *** –ê–î–†–ï–°–ê –í–ê–®–û–ì–û REPLIT-–°–ï–†–í–ï–†–ê ***
        const SERVER_URL = 'https://73cb3e0f-9347-442d-8324-f8f7d845c9c0-00-3avk0bxajugjr.kirk.replit.dev';
        // **********************************

        const socket = io(SERVER_URL);
        const gameArea = document.getElementById('game-area');
        const statusMessage = document.getElementById('status-message');
        const player1Mallet = document.getElementById('player1');
        const player2Mallet = document.getElementById('player2');

        let myPlayerNumber = 0; 
        let myMallet = null;

        // ---------------------------------------------------
        // –£–ù–Ü–í–ï–†–°–ê–õ–¨–ù–ê –õ–û–ì–Ü–ö–ê –†–£–•–£ (–ú–ò–®–ê + –î–û–¢–ò–ö)
        // ---------------------------------------------------
        
        // –ü–æ–≤–µ—Ä—Ç–∞—î –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –∑ –ø–æ–¥—ñ—ó (–º–∏—à–∞ –∞–±–æ –¥–æ—Ç–∏–∫)
        function getCoords(e) {
            if (e.touches && e.touches.length > 0) {
                // –°–µ–Ω—Å–æ—Ä–Ω–∏–π –µ–∫—Ä–∞–Ω
                return { clientX: e.touches[0].clientX, clientY: e.touches[0].clientY };
            } else {
                // –ú–∏—à–∞
                return e;
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è, —â–æ –∞–∫—Ç–∏–≤—É—î –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è
        function enableDragging() {
            if (myPlayerNumber === 0 || !myMallet) return;

            let shiftX, shiftY;

            function moveAt(pageX, pageY) {
                let newX = pageX - shiftX - gameArea.getBoundingClientRect().left;
                let newY = pageY - shiftY - gameArea.getBoundingClientRect().top;

                // 1. –û–±–º–µ–∂–µ–Ω–Ω—è: –Ω–µ –¥–æ–∑–≤–æ–ª—è—î–º–æ –≤–∏–π—Ç–∏ –∑–∞ –º–µ–∂—ñ –ø–æ–ª—è
                newX = Math.max(0, Math.min(gameArea.clientWidth - myMallet.offsetWidth, newX));
                newY = Math.max(0, Math.min(gameArea.clientHeight - myMallet.offsetHeight, newY));

                // 2. –û–±–º–µ–∂–µ–Ω–Ω—è: –ì—Ä–∞–≤–µ—Ü—å 1/2 –≥—Ä–∞—î –ª–∏—à–µ —É —Å–≤–æ—ó–π –ø–æ–ª–æ–≤–∏–Ω—ñ
                if (myPlayerNumber === 1) {
                    // –õ—ñ–≤–∞ –ø–æ–ª–æ–≤–∏–Ω–∞
                    newX = Math.min((gameArea.clientWidth / 2) - myMallet.offsetWidth, newX);
                } 
                else if (myPlayerNumber === 2) {
                    // –ü—Ä–∞–≤–∞ –ø–æ–ª–æ–≤–∏–Ω–∞
                    newX = Math.max(gameArea.clientWidth / 2, newX);
                }

                myMallet.style.left = newX + 'px';
                myMallet.style.top = newY + 'px';
                
                // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                socket.emit('player_move', { x: newX, y: newY });
            }

            // –û–±—Ä–æ–±–∫–∞ –ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è
            function startDrag(e) {
                if (myPlayerNumber === 0) return;
                
                const coords = getCoords(e);
                
                shiftX = coords.clientX - myMallet.getBoundingClientRect().left;
                shiftY = coords.clientY - myMallet.getBoundingClientRect().top;
                
                // –ü—Ä–∏–≤'—è–∑–∫–∞ –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ —Ä—É—Ö—É —Ç–∞ –∫—ñ–Ω—Ü—è
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('touchmove', onTouchMove, { passive: false }); 
                document.addEventListener('mouseup', endDrag);
                document.addEventListener('touchend', endDrag);

                // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ —Å–∫—Ä–æ–ª—ñ–Ω–≥—É –ø—ñ–¥ —á–∞—Å –ø–æ—á–∞—Ç–∫—É –¥–æ—Ç–∏–∫—É
                if (e.type === 'touchstart') {
                     e.preventDefault(); 
                }
            }

            function onMouseMove(e) {
                moveAt(e.clientX, e.clientY);
            }
            
            function onTouchMove(e) {
                // e.preventDefault() –≤–∏–∫–ª–∏–∫–∞–Ω–æ —É startDrag –¥–ª—è touchstart
                const coords = getCoords(e);
                moveAt(coords.clientX, coords.clientY);
            }

            function endDrag() {
                // –ó–Ω—ñ–º–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('touchmove', onTouchMove);
                document.removeEventListener('mouseup', endDrag);
                document.removeEventListener('touchend', endDrag);
            }
            
            // –ü—Ä–∏–≤'—è–∑–∫–∞ –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –ø–æ–¥—ñ–π –¥–æ –∫–ª—é—á–∫–∏
            myMallet.addEventListener('mousedown', startDrag);
            myMallet.addEventListener('touchstart', startDrag);
            
            myMallet.ondragstart = () => false; // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—é
        }

        // ---------------------------------------------------
        // SOCKET.IO (–ó–í'–Ø–ó–û–ö –Ü–ó –°–ï–†–í–ï–†–û–ú)
        // ---------------------------------------------------

        // 1. –£—Å–ø—ñ—à–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('connect', () => {
            statusMessage.textContent = '‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞. –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ...';
        });

        // 2. –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ (1, 2 –∞–±–æ 0)
        socket.on('player_assignment', (playerNumber) => {
            myPlayerNumber = playerNumber;
            if (myPlayerNumber === 1) {
                myMallet = player1Mallet;
                player1Mallet.style.backgroundColor = 'lime'; // –ü—ñ–¥—Å–≤—ñ—á—É—î–º–æ —Å–≤–æ—é –∫–ª—é—á–∫—É
                statusMessage.textContent = '–í–∏ –ì—Ä–∞–≤–µ—Ü—å 1 (–°–∏–Ω—è –∑–æ–Ω–∞). –ß–µ–∫–∞—î–º–æ —Å—É–ø–µ—Ä–Ω–∏–∫–∞.';
            } else if (myPlayerNumber === 2) {
                myMallet = player2Mallet;
                player2Mallet.style.backgroundColor = 'lime'; // –ü—ñ–¥—Å–≤—ñ—á—É—î–º–æ —Å–≤–æ—é –∫–ª—é—á–∫—É
                statusMessage.textContent = '–í–∏ –ì—Ä–∞–≤–µ—Ü—å 2 (–ß–µ—Ä–≤–æ–Ω–∞ –∑–æ–Ω–∞). –ß–µ–∫–∞—î–º–æ —Å—É–ø–µ—Ä–Ω–∏–∫–∞.';
            } else {
                statusMessage.textContent = '‚ùå –£—Å—ñ –º—ñ—Å—Ü—è –∑–∞–π–Ω—è—Ç—ñ. –í–∏ –°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á.';
            }
            
            // –ê–∫—Ç–∏–≤—É—î–º–æ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –ª–∏—à–µ –ø—ñ—Å–ª—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
            if (myMallet) {
                enableDragging();
            }
        });

        // 3. –ü–æ—á–∞—Ç–æ–∫ –≥—Ä–∏
        socket.on('game_start', (msg) => {
            statusMessage.textContent = `üöÄ ${msg}`;
            if (myMallet) {
                myMallet.style.backgroundColor = 'white'; // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–ª—é—á–∫—É –¥–æ –±—ñ–ª–æ–≥–æ (—ñ–≥—Ä–æ–≤—ñ –∫–æ–ª—å–æ—Ä–∏)
            }
        });

        // 4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó —Å—É–ø–µ—Ä–Ω–∏–∫–∞
        socket.on('opponent_move', (data) => {
            // –Ø–∫—â–æ —è –ì—Ä–∞–≤–µ—Ü—å 1, —è —Ä—É—Ö–∞—é player2Mallet
            if (myPlayerNumber === 1 && data.player === 2) {
                player2Mallet.style.left = data.x + 'px';
                player2Mallet.style.top = data.y + 'px';
            }
            // –Ø–∫—â–æ —è –ì—Ä–∞–≤–µ—Ü—å 2, —è —Ä—É—Ö–∞—é player1Mallet
            else if (myPlayerNumber === 2 && data.player === 1) {
                player1Mallet.style.left = data.x + 'px';
                player1Mallet.style.top = data.y + 'px';
            }
        });
        
        // 5. –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å—É–ø–µ—Ä–Ω–∏–∫–∞
        socket.on('opponent_
