<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Hockey - –û–Ω–ª–∞–π–Ω</title>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #333; }
        #game-area { width: 600px; height: 400px; background-color: #008080; border: 10px solid #ccc; position: relative; overflow: hidden; }
        .player-mallet { width: 50px; height: 50px; background-color: white; border-radius: 50%; position: absolute; cursor: pointer; border: 3px solid black; }
        #player1 { top: 175px; left: 50px; background-color: blue; }
        #player2 { top: 175px; right: 50px; background-color: red; }
        #status-message { position: absolute; top: 10px; left: 10px; color: white; font-family: Arial, sans-serif; }
    </style>
</head>
<body>
    <div id="game-area">
        <div id="player1" class="player-mallet"></div>
        <div id="player2" class="player-mallet"></div>
        <div id="status-message">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...</div>
    </div>

    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script>
        // *** –ê–î–†–ï–°–ê –í–ê–®–û–ì–û REPLIT-–°–ï–†–í–ï–†–ê ***
        const SERVER_URL = 'https://73cb3e0f-9347-442d-8324-f8f7d845c9c0-00-3avk0bxajugjr.kirk.replit.dev';
        // **********************************

        const socket = io(SERVER_URL);
        const gameArea = document.getElementById('game-area');
        const statusMessage = document.getElementById('status-message');
        const player1Mallet = document.getElementById('player1');
        const player2Mallet = document.getElementById('player2');

        let myPlayerNumber = 0; // 1, 2, –∞–±–æ 0 (—Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á)
        let myMallet = null;

        // --- 1. –û–±—Ä–æ–±–∫–∞ –ó'—î–¥–Ω–∞–Ω–Ω—è —Ç–∞ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ì—Ä–∞–≤—Ü—è ---
        socket.on('connect', () => {
            statusMessage.textContent = '‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞. –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –≥—Ä–∞–≤—Ü—è...';
        });

        socket.on('player_assignment', (playerNumber) => {
            myPlayerNumber = playerNumber;
            if (myPlayerNumber === 1) {
                myMallet = player1Mallet;
                player1Mallet.style.backgroundColor = 'lime';
                statusMessage.textContent = '–í–∏ –ì—Ä–∞–≤–µ—Ü—å 1 (—Å–∏–Ω—ñ–π). –ß–µ–∫–∞—î–º–æ —Å—É–ø–µ—Ä–Ω–∏–∫–∞.';
            } else if (myPlayerNumber === 2) {
                myMallet = player2Mallet;
                player2Mallet.style.backgroundColor = 'lime';
                statusMessage.textContent = '–í–∏ –ì—Ä–∞–≤–µ—Ü—å 2 (—á–µ—Ä–≤–æ–Ω–∏–π). –ß–µ–∫–∞—î–º–æ —Å—É–ø–µ—Ä–Ω–∏–∫–∞.';
            } else {
                statusMessage.textContent = '‚ùå –£—Å—ñ –º—ñ—Å—Ü—è –∑–∞–π–Ω—è—Ç—ñ. –í–∏ –°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á.';
            }
        });

        socket.on('game_start', (msg) => {
            statusMessage.textContent = `üöÄ ${msg}`;
        });

        socket.on('opponent_disconnected', (msg) => {
             statusMessage.textContent = `üö´ ${msg}`;
        });

        // --- 2. –õ–æ–≥—ñ–∫–∞ –†—É—Ö—É (–¥–ª—è –≥—Ä–∞–≤—Ü—è 1) ---
        if (myMallet) {
            myMallet.onmousedown = (e) => {
                if (myPlayerNumber === 0) return; // –°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á—ñ –Ω–µ —Ä—É—Ö–∞—é—Ç—å—Å—è

                let shiftX = e.clientX - myMallet.getBoundingClientRect().left;
                let shiftY = e.clientY - myMallet.getBoundingClientRect().top;

                function moveAt(pageX, pageY) {
                    let newX = pageX - shiftX - gameArea.getBoundingClientRect().left;
                    let newY = pageY - shiftY - gameArea.getBoundingClientRect().top;

                    // –û–±–º–µ–∂–µ–Ω–Ω—è: –Ω–µ –¥–æ–∑–≤–æ–ª—è—î–º–æ –≤–∏–π—Ç–∏ –∑–∞ –º–µ–∂—ñ –ø–æ–ª—è
                    newX = Math.max(0, Math.min(gameArea.clientWidth - myMallet.offsetWidth, newX));
                    newY = Math.max(0, Math.min(gameArea.clientHeight - myMallet.offsetHeight, newY));

                    // –û–±–º–µ–∂–µ–Ω–Ω—è: –ì—Ä–∞–≤–µ—Ü—å 1 –≥—Ä–∞—î –ª–∏—à–µ —É –ª—ñ–≤—ñ–π –ø–æ–ª–æ–≤–∏–Ω—ñ
                    if (myPlayerNumber === 1) {
                        newX = Math.min((gameArea.clientWidth / 2) - myMallet.offsetWidth, newX);
                    } 
                    // –û–±–º–µ–∂–µ–Ω–Ω—è: –ì—Ä–∞–≤–µ—Ü—å 2 –≥—Ä–∞—î –ª–∏—à–µ —É –ø—Ä–∞–≤—ñ–π –ø–æ–ª–æ–≤–∏–Ω—ñ
                    else if (myPlayerNumber === 2) {
                        newX = Math.max(gameArea.clientWidth / 2, newX);
                    }

                    myMallet.style.left = newX + 'px';
                    myMallet.style.top = newY + 'px';
                    
                    // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    socket.emit('player_move', { x: newX, y: newY });
                }

                function onMouseMove(event) {
                    moveAt(event.clientX, event.clientY);
                }

                document.addEventListener('mousemove', onMouseMove);

                myMallet.onmouseup = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    myMallet.onmouseup = null;
                };
            };
            myMallet.ondragstart = () => false; // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—é
        }


        // --- 3. –û–±—Ä–æ–±–∫–∞ –†—É—Ö—É –°—É–ø–µ—Ä–Ω–∏–∫–∞ ---
        socket.on('opponent_move', (data) => {
            // –†—É—Ö –ì—Ä–∞–≤–µ—Ü—å 1 (—è –±–∞—á—É —Ä—É—Ö –≥—Ä–∞–≤—Ü—è 2)
            if (myPlayerNumber === 1 && data.player === 2) {
                player2Mallet.style.left = data.x + 'px';
                player2Mallet.style.top = data.y + 'px';
            }
            // –†—É—Ö –ì—Ä–∞–≤–µ—Ü—å 2 (—è –±–∞—á—É —Ä—É—Ö –≥—Ä–∞–≤—Ü—è 1)
            else if (myPlayerNumber === 2 && data.player === 1) {
                player1Mallet.style.left = data.x + 'px';
                player1Mallet.style.top = data.y + 'px';
            }
        });
        
    </script>
</body>
</html>
